---
/*
  This is not a layout but just a component that's used in layouts.
*/
---

<script is:inline>
  // figure out user's preferred theme and set it as html class for tailwind before paint
  function setUserTheme () {
    if (typeof window !== "undefined") {
      const isSystemColorSchemeDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      const storageTheme = sessionStorage.getItem("theme");
      if (!storageTheme && isSystemColorSchemeDark) {
        document.documentElement.classList.add("dark");
        document.head.children.namedItem("theme-color").content = "#262626";
      } else if (storageTheme === "dark") {
        const toggle = document.querySelector("button");
        const iconElem = toggle?.querySelector("#mode-circle");

        if (iconElem) {
          iconElem.classList.remove("light");
          iconElem.classList.add("dark");
        }  
        // we load the toggle invisible to prevent flash
        // remove visibility class after setting initial dark/light class
        document.documentElement.classList.add("dark");
        document.head.children.namedItem("theme-color").content = "#262626";
      } else {
        // we already server render light theme
        document.head.children.namedItem("theme-color").content = "#ffffff";
      }
    }
  };
  setUserTheme();
  document.addEventListener('astro:after-swap', setUserTheme);
</script>
